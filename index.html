<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calendario de Rodadas</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  margin: 0;
  padding: 10px;
}
.container {
  max-width: 1000px;
  margin: auto;
}
h1, h2 {
  text-align: center;
}
.top {
  display: flex;
  gap: 10px;
  justify-content: center;
  flex-wrap: wrap;
}
input, button {
  padding: 8px;
  font-size: 15px;
}
button {
  background: #dc2626;
  border: none;
  color: white;
  border-radius: 6px;
  cursor: pointer;
}
button:hover { opacity: 0.85; }

.calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 5px;
  margin-top: 10px;
}
.weekday {
  text-align: center;
  font-weight: bold;
  color: #9ca3af;
}
.day {
  min-height: 80px;
  border-radius: 8px;
  padding: 5px;
  border: 1px solid #334155;
  cursor: pointer;
  position: relative;
}
.day.other { opacity: 0.25; cursor: default; }
.day.weekend { background: #020617; }
.day.holiday { background: #4c0519; }
.day.selected { outline: 2px solid #38bdf8; }
.day.majority { background: #065f46; }

.day span {
  position: absolute;
  top: 5px;
  right: 8px;
  font-size: 14px;
}

.legend {
  display: flex;
  justify-content: center;
  gap: 15px;
  font-size: 13px;
  margin-top: 10px;
}

.box {
  background: #020617;
  padding: 10px;
  border-radius: 8px;
  margin-top: 15px;
}
.small { font-size: 13px; color: #9ca3af; }
</style>
</head>

<body>
<div class="container">
  <h1>üèçÔ∏è Calendario de Rodadas</h1>

  <div class="top">
    <input id="user" placeholder="Tu nombre o apodo">
    <button onclick="login()">Entrar</button>
    <button onclick="prevMonth()">‚óÄ</button>
    <button onclick="nextMonth()">‚ñ∂</button>
  </div>

  <h2 id="monthTitle"></h2>

  <div class="calendar" id="weekdays"></div>
  <div class="calendar" id="calendar"></div>

  <div class="legend">
    <div>üü® Fin de semana</div>
    <div>üéâ Feriado</div>
    <div>üü¢ Mayor√≠a</div>
  </div>

  <div class="box">
    <h2>üî• D√≠as con mayor√≠a</h2>
    <div id="majorityList" class="small"></div>
  </div>
</div>

<script>
const MAX_USERS = 20;
const STORAGE = "rodadas_v2";
let currentUser = null;

let date = new Date();
let year = date.getFullYear();
let month = date.getMonth();

/* üîß CONFIGURA AQU√ç LOS FERIADOS (YYYY-MM-DD) */
const HOLIDAYS = [
  "2025-01-01",
  "2025-01-22",
  "2025-05-01",
  "2025-08-06",
  "2025-12-25"
];

const weekdays = ["Lun","Mar","Mi√©","Jue","Vie","S√°b","Dom"];

function login() {
  const name = user.value.trim();
  if (!name) return alert("Escribe tu nombre");
  currentUser = name;
  render();
}

function getData() {
  return JSON.parse(localStorage.getItem(STORAGE)) || {};
}
function saveData(d) {
  localStorage.setItem(STORAGE, JSON.stringify(d));
}

function toggleDay(key) {
  if (!currentUser) return alert("Primero entra con tu nombre");

  const data = getData();
  data[key] = data[key] || { users: [], votes: {} };

  const i = data[key].users.indexOf(currentUser);
  if (i >= 0) data[key].users.splice(i, 1);
  else {
    if (data[key].users.length >= MAX_USERS) return;
    data[key].users.push(currentUser);
  }

  saveData(data);
  render();
}

function vote(key) {
  const dest = prompt("Destino:");
  if (!dest) return;
  const data = getData();
  data[key].votes[dest] = (data[key].votes[dest] || 0) + 1;
  saveData(data);
  render();
}

function render() {
  const cal = document.getElementById("calendar");
  const w = document.getElementById("weekdays");
  cal.innerHTML = "";
  w.innerHTML = "";
  weekdays.forEach(d => w.innerHTML += `<div class="weekday">${d}</div>`);

  const data = getData();
  const users = new Set();
  Object.values(data).forEach(d => d.users.forEach(u => users.add(u)));
  const majority = Math.ceil(users.size / 2);

  monthTitle.innerText =
    new Date(year, month).toLocaleString("es", { month: "long", year: "numeric" });

  const first = new Date(year, month, 1);
  let start = (first.getDay() + 6) % 7;
  const days = new Date(year, month + 1, 0).getDate();

  for (let i = 0; i < start; i++) {
    cal.innerHTML += `<div class="day other"></div>`;
  }

  let majorityHTML = "";

  for (let d = 1; d <= days; d++) {
    const key = `${year}-${month+1}-${d}`;
    const day = new Date(year, month, d);
    const isWeekend = day.getDay() === 0 || day.getDay() === 6;
    const isHoliday = HOLIDAYS.includes(key);

    let cls = "day";
    if (isWeekend) cls += " weekend";
    if (isHoliday) cls += " holiday";

    if (data[key]) {
      if (data[key].users.includes(currentUser)) cls += " selected";
      if (data[key].users.length >= majority && majority > 0) {
        cls += " majority";

        let votes = "";
        for (let v in data[key].votes) {
          votes += `<div>üìç ${v} (${data[key].votes[v]})</div>`;
        }

        majorityHTML += `
          <div>
            <strong>${d}/${month+1}</strong> ‚Äì ${data[key].users.length} disponibles
            <button onclick="vote('${key}')">Votar destino</button>
            ${votes}
          </div>`;
      }
    }

    cal.innerHTML += `
      <div class="${cls}" onclick="toggleDay('${key}')">
        <span>${d}</span>
      </div>`;
  }

  majorityList.innerHTML = majorityHTML || "A√∫n no hay coincidencias";
}

function prevMonth() {
  month--;
  if (month < 0) { month = 11; year--; }
  render();
}
function nextMonth() {
  month++;
  if (month > 11) { month = 0; year++; }
  render();
}

render();
</script>
</body>
</html>
